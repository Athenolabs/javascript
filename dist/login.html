<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Login Page</title>
    <meta name="msapplication-TileColor" content="#5bc0de" />
    <meta name="msapplication-TileImage" content="assets/img/metis-tile.png" />
    <link rel="stylesheet" href="assets/lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/lib/magic/magic.css">
    <script src="assets/lib/jquery.min.js"></script>
    <script src="assets/lib/bootstrap/js/bootstrap.js"></script>
    <script src="assets/lib/utils.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.0.0-rc13.min.js"></script>
    <script>
      (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
      ga('create', 'UA-1669764-16', 'onokumus.com');
      ga('send', 'pageview');
    </script>
  </head>
  <body class="login">
    <div class="container">
      <div class="text-center">
        <img src="assets/img/logo.png" alt="Metis Logo">
      </div>
      <div class="tab-content">
        <div id="login" class="tab-pane active">
          <form action="index.html" class="form-signin">
            <p class="text-muted text-center">
              Enter your AWS Access Key ID and password
            </p>
            <input name="access-key-id" type="text" placeholder="Access Key ID" class="form-control">
            <input name="secret-access-key" type="password" placeholder="Secret Access Key" class="form-control">
            <input name="root-directory" type="text" placeholder="Root directory" class="form-control">
            <div class="text-muted text-center">
              <label>
                <input class="uniform" type="checkbox" value="remember">&nbsp; Remember me on this computer
              </label>
            </div>
            <button class="btn btn-lg btn-primary btn-block" type="submit">Log in</button>
          </form>
        </div>
      </div><!-- /container -->
      <script type="text/javascript">
        $('.form-signin').bind('submit', function() {
          var form = this,
            accessKeyId = $('input[name=access-key-id]', form).val(),
            secretAccessKey = $('input[name=secret-access-key]', form).val(),
            rootDirectory = $('input[name=root-directory]', form).val();
          if (rootDirectory == '') {
            alert('Root directory should not be empty');
            return false;
          }
          AWS.config.update({
            accessKeyId: accessKeyId,
            secretAccessKey: secretAccessKey
          });
          AWS.config.region = 'eu-west-1';
          var s3 = new AWS.S3({
            region: 'eu-west-1',
            maxRetries: 1
          }),
            bucket = 'librelio-europe';
          $('button', form).prop('disabled', true);
          s3.listObjects({
            Bucket: bucket,
            Prefix: rootDirectory,
            MaxKeys: 1
          }, function(err, data) {
            if (err) {
              alert("Couldn't connect to aws s3: " + err);
            } else if (!data || !data.Contents ||
              data.Contents.length <= 0) {
              alert("Invalid directory!");
            } else {
              if (!supports_html5_storage())
                alert("This app does not support your browser");
              else {
                var auth_obj = {
                  accessKeyId: accessKeyId,
                  secretAccessKey: secretAccessKey,
                  rootDirectory: rootDirectory
                };
                localStorage.setItem('libreliodev-auth', JSON.stringify(auth_obj));
                document.location = "index.html";
              }
            }
            $('button', form).prop('disabled', false);
          });
          return false;
        });
      </script>
      <script>
        $('.list-inline li > a').click(function() {
          var activeForm = $(this).attr('href') + ' > form';
          //console.log(activeForm);
          $(activeForm).addClass('magictime swap');
          //set timer to 1 seconds, after that, unload the magic animation
          setTimeout(function() {
            $(activeForm).removeClass('magictime swap');
          }, 1000);
        });
      </script>
  </body>
</html>
